# Render.com Deployment Guide

Complete guide for deploying the Insurance Visualizer application to Render.com using Blueprint.

## ðŸ“‹ Prerequisites

- GitHub account with repository access
- Render.com account (free tier available)
- Aiven MySQL database (or any MySQL 8.x database)

## ðŸš€ Deployment Steps

### Step 1: Prepare Your GitHub Repository

Ensure your code is pushed to GitHub:

```bash
git push origin main
```

### Step 2: Create Render Blueprint

1. **Go to Render Dashboard**: https://dashboard.render.com/
2. **Click "New +"** in the top right
3. **Select "Blueprint"** from the dropdown
4. **Connect GitHub Repository**:
   - Click "Connect account" if not already connected
   - Search for your repository: `rathanraju45/Insurance_Visualizer`
   - Click "Connect"

### Step 3: Configure Environment Variables

Render will detect the `render.yaml` file and show you the services. You need to configure these environment variables:

#### Backend Service (insurance-visualizer-api)

Set these variables (marked as `sync: false` in render.yaml):

| Variable | Value | Example |
|----------|-------|---------|
| `DB_HOST` | Your MySQL host | `mysql-xxxxx.aivencloud.com` |
| `DB_PORT` | MySQL port | `12345` |
| `DB_USER` | Database username | `avnadmin` |
| `DB_PASS` | Database password | `your-secure-password` |
| `DB_NAME` | Database name | `insurance_viz` |

**Note**: The following are auto-configured:
- âœ… `NODE_ENV=production` (hardcoded)
- âœ… `PORT=3000` (hardcoded)
- âœ… `JWT_SECRET` (auto-generated by Render)
- âœ… `CORS_ORIGIN` (set to frontend URL)

#### Frontend Service (insurance-visualizer-frontend)

Auto-configured:
- âœ… `VITE_API_BASE=https://insurance-visualizer-api.onrender.com/api` (hardcoded)

### Step 4: Deploy

1. **Review the Blueprint configuration**
2. **Click "Apply"** to start deployment
3. **Wait 5-10 minutes** for both services to build and deploy

## ðŸ“Š Post-Deployment Setup

### 1. Initialize Database

Once the backend is deployed, you need to create the database tables and default user:

**Option A: Using Render Shell (Recommended)**

1. Go to Render Dashboard â†’ Backend Service â†’ "Shell" tab
2. Run these commands:

```bash
# Create users table and default admin user
node create-users-table.js

# Verify tables exist
node -e "const db = require('./DB/db'); db.query('SHOW TABLES').then(r => console.log(r[0]))"
```

**Option B: Run Locally Against Production DB**

```bash
# In your local server directory
cd server

# Create production .env with your Render database credentials
cat > .env.production << EOF
DB_HOST=your-aiven-host
DB_PORT=12345
DB_USER=avnadmin
DB_PASS=your-password
DB_NAME=insurance_viz
EOF

# Run initialization script
node -r dotenv/config create-users-table.js dotenv_config_path=.env.production
```

### 2. Test Your Deployment

**Frontend**: `https://insurance-visualizer-frontend.onrender.com`

**Backend API**: `https://insurance-visualizer-api.onrender.com/api`

**Test Login**:
- Username: `admin`
- Password: `admin123`

### 3. Verify Everything Works

âœ… Login page loads  
âœ… Can log in with admin credentials  
âœ… Dashboard displays data  
âœ… API calls work (check browser console)  
âœ… No localhost URLs in network tab  

## ðŸ”§ Troubleshooting

### Issue: "Connection Refused" or "Network Error"

**Cause**: Frontend trying to connect to localhost instead of production API.

**Solution**: Verify `VITE_API_BASE` is set correctly:
1. Go to Render Dashboard â†’ Frontend Service â†’ Environment
2. Check `VITE_API_BASE=https://insurance-visualizer-api.onrender.com/api`
3. Trigger a manual deploy to rebuild with correct env var

### Issue: "401 Unauthorized" on All API Calls

**Cause**: CORS not configured correctly.

**Solution**: Check backend `CORS_ORIGIN`:
1. Go to Render Dashboard â†’ Backend Service â†’ Environment
2. Verify `CORS_ORIGIN=https://insurance-visualizer-frontend.onrender.com`
3. Restart backend service

### Issue: "Database Connection Failed"

**Cause**: Incorrect database credentials or database not accessible.

**Solution**:
1. Verify all `DB_*` environment variables are set correctly
2. Check Aiven database is running and accessible
3. Check Render backend logs for specific error messages

### Issue: Free Tier Services Spin Down

**Note**: Render free tier services spin down after 15 minutes of inactivity.

**Solution**: 
- First request will be slow (30-60 seconds) as services spin up
- Consider upgrading to paid tier for production use
- Or use a service like UptimeRobot to ping your app every 10 minutes

## ðŸ”„ Updating Your Deployment

After making code changes:

```bash
# Commit and push changes
git add .
git commit -m "Your changes"
git push origin main
```

Render will automatically:
1. Detect the push
2. Rebuild both services
3. Deploy new versions (3-5 minutes)

## ðŸ“ Manual Deploy

To manually trigger a deployment:

1. Go to Render Dashboard
2. Select the service (backend or frontend)
3. Click "Manual Deploy" â†’ "Deploy latest commit"

## ðŸ” Security Best Practices

1. **Change Default Admin Password** immediately after first login
2. **Use Strong JWT_SECRET** - Let Render auto-generate or use: `openssl rand -base64 32`
3. **Enable Database SSL** - Add SSL certificate if using production database
4. **Review User Permissions** - Audit who has access to what
5. **Regular Backups** - Set up automated database backups
6. **Monitor Logs** - Check Render logs regularly for errors

## ðŸ’° Cost Considerations

**Free Tier**:
- âœ… 750 hours/month (enough for 1 service 24/7)
- âœ… 100 GB bandwidth/month
- âš ï¸ Services spin down after 15 min inactivity
- âš ï¸ 90 day limit for free tier

**Paid Tier** ($7/month per service):
- âœ… No spin down
- âœ… Faster build times
- âœ… More bandwidth

## ðŸ“š Additional Resources

- [Render Documentation](https://render.com/docs)
- [Render Blueprint Reference](https://render.com/docs/blueprint-spec)
- [Aiven MySQL Documentation](https://aiven.io/docs/products/mysql)

## ðŸ†˜ Support

If you encounter issues:
1. Check Render logs (Dashboard â†’ Service â†’ Logs)
2. Review browser console for frontend errors
3. Test API endpoints directly using Postman
4. Verify environment variables are set correctly
5. Check database connectivity from Render shell
